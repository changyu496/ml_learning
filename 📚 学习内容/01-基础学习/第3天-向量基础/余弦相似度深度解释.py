#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ä½™å¼¦ç›¸ä¼¼åº¦ vs ç‚¹ç§¯ï¼šä¸ºä»€ä¹ˆæ›´å‡†ç¡®ï¼Ÿ
è¯¦ç»†è§£é‡Šcosine_similarityçš„åŸç†å’Œä¼˜åŠ¿
"""

import numpy as np
import matplotlib.pyplot as plt
from sklearn.metrics.pairwise import cosine_similarity

# è®¾ç½®ä¸­æ–‡å­—ä½“
plt.rcParams['font.sans-serif'] = ['Arial Unicode MS', 'SimHei']
plt.rcParams['axes.unicode_minus'] = False

def explain_cosine_similarity():
    print("ğŸ“ ä½™å¼¦ç›¸ä¼¼åº¦ vs ç‚¹ç§¯ï¼šæ·±åº¦å¯¹æ¯”")
    print("=" * 50)
    
    print("ğŸ¤” é¦–å…ˆï¼Œä»€ä¹ˆæ˜¯ä½™å¼¦ç›¸ä¼¼åº¦ï¼Ÿ")
    print("-" * 30)
    
    print("ğŸ’¡ æ ¸å¿ƒå…¬å¼:")
    print("ä½™å¼¦ç›¸ä¼¼åº¦ = ç‚¹ç§¯ / (å‘é‡Aé•¿åº¦ Ã— å‘é‡Bé•¿åº¦)")
    print("cosine_similarity(A, B) = (A Â· B) / (||A|| Ã— ||B||)")
    print("å–å€¼èŒƒå›´: -1 åˆ° 1")
    print("- 1: å®Œå…¨ç›¸åŒæ–¹å‘")
    print("- 0: å‚ç›´ï¼ˆæ— å…³ï¼‰") 
    print("- -1: å®Œå…¨ç›¸åæ–¹å‘")
    
    print(f"\n" + "="*50)
    print(f"ğŸ›’ é—®é¢˜ï¼šä¸ºä»€ä¹ˆéœ€è¦ä½™å¼¦ç›¸ä¼¼åº¦ï¼Ÿ")
    print(f"="*50)
    
    # åˆ›å»ºä¸€ä¸ªè¯´æ˜æ€§çš„ä¾‹å­
    print(f"\nğŸ“Š ç”¨æˆ·è¯„åˆ†ä¾‹å­:")
    
    # ç”¨æˆ·Aï¼šè½»åº¦ä½¿ç”¨è€…
    ç”¨æˆ·A = np.array([2, 1, 2, 1, 1])  # æ€»è®¡7æ¬¡è´­ä¹°ï¼Œæ¯”è¾ƒä¿å®ˆ
    # ç”¨æˆ·Bï¼šé‡åº¦ä½¿ç”¨è€…ï¼Œä½†åå¥½ç›¸ä¼¼
    ç”¨æˆ·B = np.array([8, 4, 8, 4, 4])  # æ€»è®¡28æ¬¡è´­ä¹°ï¼Œæ˜¯Açš„4å€
    # ç”¨æˆ·Cï¼šè½»åº¦ä½¿ç”¨è€…ï¼Œä½†åå¥½ä¸åŒ
    ç”¨æˆ·C = np.array([1, 2, 1, 2, 1])  # æ€»è®¡7æ¬¡è´­ä¹°ï¼Œåå¥½ä¸åŒ
    
    movies = ['åŠ¨ä½œç‰‡', 'å–œå‰§ç‰‡', 'ç§‘å¹»ç‰‡', 'çˆ±æƒ…ç‰‡', 'ææ€–ç‰‡']
    
    print(f"ç”¨æˆ·A: {ç”¨æˆ·A} (è½»åº¦ç”¨æˆ·ï¼Œå–œæ¬¢åŠ¨ä½œç‰‡å’Œç§‘å¹»ç‰‡)")
    print(f"ç”¨æˆ·B: {ç”¨æˆ·B} (é‡åº¦ç”¨æˆ·ï¼Œä¹Ÿå–œæ¬¢åŠ¨ä½œç‰‡å’Œç§‘å¹»ç‰‡)")  
    print(f"ç”¨æˆ·C: {ç”¨æˆ·C} (è½»åº¦ç”¨æˆ·ï¼Œå–œæ¬¢å–œå‰§ç‰‡å’Œçˆ±æƒ…ç‰‡)")
    
    # è®¡ç®—ç‚¹ç§¯
    dot_AB = np.dot(ç”¨æˆ·A, ç”¨æˆ·B)
    dot_AC = np.dot(ç”¨æˆ·A, ç”¨æˆ·C)
    
    print(f"\nğŸ§® ç‚¹ç§¯è®¡ç®—:")
    print(f"ç”¨æˆ·A Â· ç”¨æˆ·B = {dot_AB}")
    print(f"ç”¨æˆ·A Â· ç”¨æˆ·C = {dot_AC}")
    print(f"ç‚¹ç§¯ç»“è®º: Aå’ŒBæ›´ç›¸ä¼¼ ({dot_AB} > {dot_AC})")
    
    # è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦
    cos_AB = cosine_similarity([ç”¨æˆ·A], [ç”¨æˆ·B])[0][0]
    cos_AC = cosine_similarity([ç”¨æˆ·A], [ç”¨æˆ·C])[0][0]
    
    print(f"\nğŸ“ ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—:")
    print(f"ç”¨æˆ·A vs ç”¨æˆ·B = {cos_AB:.3f}")
    print(f"ç”¨æˆ·A vs ç”¨æˆ·C = {cos_AC:.3f}")
    print(f"ä½™å¼¦ç›¸ä¼¼åº¦ç»“è®º: Aå’ŒBæ›´ç›¸ä¼¼ ({cos_AB:.3f} > {cos_AC:.3f})")
    
    print(f"\nğŸ’¡ ä¸¤ç§æ–¹æ³•çš„åŒºåˆ«:")
    print(f"- ç‚¹ç§¯å·®å¼‚: {dot_AB - dot_AC}")
    print(f"- ä½™å¼¦ç›¸ä¼¼åº¦å·®å¼‚: {cos_AB - cos_AC:.3f}")
    
    # æ‰‹å·¥è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦éªŒè¯
    print(f"\nğŸ§® æ‰‹å·¥è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦éªŒè¯:")
    
    # Aå’ŒBçš„ä½™å¼¦ç›¸ä¼¼åº¦
    norm_A = np.linalg.norm(ç”¨æˆ·A)
    norm_B = np.linalg.norm(ç”¨æˆ·B)
    manual_cos_AB = dot_AB / (norm_A * norm_B)
    
    print(f"\nç”¨æˆ·A vs ç”¨æˆ·B:")
    print(f"ç‚¹ç§¯: {dot_AB}")
    print(f"ç”¨æˆ·Aé•¿åº¦: {norm_A:.3f}")
    print(f"ç”¨æˆ·Bé•¿åº¦: {norm_B:.3f}")
    print(f"æ‰‹å·¥è®¡ç®—: {dot_AB} / ({norm_A:.3f} Ã— {norm_B:.3f}) = {manual_cos_AB:.3f}")
    print(f"sklearnç»“æœ: {cos_AB:.3f}")
    print(f"éªŒè¯: {abs(manual_cos_AB - cos_AB) < 1e-10}")

def demonstrate_cosine_advantage():
    """æ¼”ç¤ºä½™å¼¦ç›¸ä¼¼åº¦çš„ä¼˜åŠ¿"""
    print(f"\n" + "="*50)
    print(f"ğŸ¯ ä½™å¼¦ç›¸ä¼¼åº¦çš„æ ¸å¿ƒä¼˜åŠ¿")
    print(f"="*50)
    
    print(f"\nğŸ” é—®é¢˜åœºæ™¯ï¼šç”¨æˆ·è´­ä¹°è§„æ¨¡å·®å¼‚å¾ˆå¤§")
    
    # ä¸‰ä¸ªç”¨æˆ·ï¼šåå¥½ç›¸ä¼¼ä½†è´­ä¹°è§„æ¨¡ä¸åŒ
    è½»åº¦ç”¨æˆ· = np.array([3, 1, 3, 1, 1])    # 9æ¬¡è´­ä¹°ï¼Œåå¥½åŠ¨ä½œ+ç§‘å¹»
    ä¸­åº¦ç”¨æˆ· = np.array([6, 2, 6, 2, 2])    # 18æ¬¡è´­ä¹°ï¼Œç›¸åŒåå¥½
    é‡åº¦ç”¨æˆ· = np.array([15, 5, 15, 5, 5])  # 45æ¬¡è´­ä¹°ï¼Œç›¸åŒåå¥½
    
    # åå¥½ä¸åŒçš„ç”¨æˆ·
    ä¸åŒç”¨æˆ· = np.array([1, 4, 1, 4, 1])    # 11æ¬¡è´­ä¹°ï¼Œåå¥½å–œå‰§+çˆ±æƒ…
    
    users = {
        'è½»åº¦ç”¨æˆ·': è½»åº¦ç”¨æˆ·,
        'ä¸­åº¦ç”¨æˆ·': ä¸­åº¦ç”¨æˆ·, 
        'é‡åº¦ç”¨æˆ·': é‡åº¦ç”¨æˆ·,
        'ä¸åŒç”¨æˆ·': ä¸åŒç”¨æˆ·
    }
    
    print(f"\nğŸ“Š ç”¨æˆ·æ•°æ®:")
    for name, user in users.items():
        print(f"{name}: {user} (æ€»è´­ä¹°: {np.sum(user)})")
    
    print(f"\nğŸ§® ä»¥è½»åº¦ç”¨æˆ·ä¸ºåŸºå‡†ï¼Œè®¡ç®—ç›¸ä¼¼åº¦:")
    print(f"å¯¹æ¯”ç”¨æˆ·\tç‚¹ç§¯\tä½™å¼¦ç›¸ä¼¼åº¦\tè§£é‡Š")
    print(f"-" * 60)
    
    base_user = è½»åº¦ç”¨æˆ·
    
    for name, user in users.items():
        if name == 'è½»åº¦ç”¨æˆ·':
            continue
            
        # ç‚¹ç§¯
        dot_product = np.dot(base_user, user)
        
        # ä½™å¼¦ç›¸ä¼¼åº¦
        cos_sim = cosine_similarity([base_user], [user])[0][0]
        
        # åˆ†æ
        if name in ['ä¸­åº¦ç”¨æˆ·', 'é‡åº¦ç”¨æˆ·']:
            explanation = "åå¥½ç›¸åŒï¼Œè§„æ¨¡ä¸åŒ"
        else:
            explanation = "åå¥½ä¸åŒ"
            
        print(f"{name}\t{dot_product}\t{cos_sim:.3f}\t\t{explanation}")
    
    print(f"\nğŸ¯ å…³é”®å‘ç°:")
    print(f"1. ç‚¹ç§¯ä¼šè¢«è´­ä¹°è§„æ¨¡å½±å“ï¼ˆé‡åº¦ç”¨æˆ·åˆ†æ•°è™šé«˜ï¼‰")
    print(f"2. ä½™å¼¦ç›¸ä¼¼åº¦åªå…³æ³¨åå¥½æ¨¡å¼ï¼Œä¸å—è§„æ¨¡å½±å“")
    print(f"3. ä¸­åº¦ç”¨æˆ·å’Œé‡åº¦ç”¨æˆ·ä¸è½»åº¦ç”¨æˆ·çš„ä½™å¼¦ç›¸ä¼¼åº¦éƒ½å¾ˆé«˜")
    print(f"4. ä¸åŒåå¥½çš„ç”¨æˆ·ä½™å¼¦ç›¸ä¼¼åº¦æ˜æ˜¾è¾ƒä½")

def real_world_scenarios():
    """çœŸå®ä¸–ç•Œçš„åº”ç”¨åœºæ™¯"""
    print(f"\n" + "="*50)
    print(f"ğŸŒ çœŸå®ä¸–ç•Œåº”ç”¨åœºæ™¯")
    print(f"="*50)
    
    print(f"\nğŸ›ï¸ 1. ç”µå•†æ¨èç³»ç»Ÿ:")
    print(f"é—®é¢˜: å¤§å®¢æˆ·vså°å®¢æˆ·çš„å…¬å¹³æ¯”è¾ƒ")
    
    # æ¨¡æ‹Ÿæ•°æ®
    å¤§å®¢æˆ· = np.array([50, 10, 40, 20, 30])  # é«˜æ¶ˆè´¹ç”¨æˆ·
    å°å®¢æˆ· = np.array([5, 1, 4, 2, 3])       # ä½æ¶ˆè´¹ç”¨æˆ·ï¼Œä½†åå¥½ç›¸ä¼¼
    æ–°å®¢æˆ· = np.array([2, 0, 2, 1, 1])       # æ–°ç”¨æˆ·ï¼Œéœ€è¦æ¨è
    
    print(f"å¤§å®¢æˆ·: {å¤§å®¢æˆ·} (æ€»æ¶ˆè´¹: {np.sum(å¤§å®¢æˆ·)})")
    print(f"å°å®¢æˆ·: {å°å®¢æˆ·} (æ€»æ¶ˆè´¹: {np.sum(å°å®¢æˆ·)})")
    print(f"æ–°å®¢æˆ·: {æ–°å®¢æˆ·} (æ€»æ¶ˆè´¹: {np.sum(æ–°å®¢æˆ·)})")
    
    # å¯¹æ¯”ä¸¤ç§ç›¸ä¼¼åº¦
    dot_big = np.dot(æ–°å®¢æˆ·, å¤§å®¢æˆ·)
    dot_small = np.dot(æ–°å®¢æˆ·, å°å®¢æˆ·)
    
    cos_big = cosine_similarity([æ–°å®¢æˆ·], [å¤§å®¢æˆ·])[0][0]
    cos_small = cosine_similarity([æ–°å®¢æˆ·], [å°å®¢æˆ·])[0][0]
    
    print(f"\næ¨èä¾æ®å¯¹æ¯”:")
    print(f"æ–°å®¢æˆ· vs å¤§å®¢æˆ· - ç‚¹ç§¯: {dot_big}, ä½™å¼¦: {cos_big:.3f}")
    print(f"æ–°å®¢æˆ· vs å°å®¢æˆ· - ç‚¹ç§¯: {dot_small}, ä½™å¼¦: {cos_small:.3f}")
    
    print(f"\nç»“è®º:")
    print(f"- ç‚¹ç§¯æ¨è: å‚è€ƒå¤§å®¢æˆ· (åˆ†æ•°æ›´é«˜)")
    print(f"- ä½™å¼¦æ¨è: å‚è€ƒå°å®¢æˆ· (æ¨¡å¼æ›´ç›¸ä¼¼)")
    print(f"- ä½™å¼¦ç›¸ä¼¼åº¦æ›´å…¬å¹³ï¼Œä¸å—æ¶ˆè´¹è§„æ¨¡å½±å“!")
    
    print(f"\nğŸµ 2. éŸ³ä¹æ¨èç³»ç»Ÿ:")
    print(f"é—®é¢˜: é‡åº¦å¬ä¼—vsè½»åº¦å¬ä¼—çš„åå¥½è¯†åˆ«")
    
    é‡åº¦å¬ä¼— = np.array([100, 20, 80, 10, 90])  # æ¯å¤©å¬å¾ˆå¤šéŸ³ä¹
    è½»åº¦å¬ä¼— = np.array([10, 2, 8, 1, 9])       # å¬å¾—å°‘ä½†åå¥½ç›¸ä¼¼
    ç›®æ ‡ç”¨æˆ· = np.array([5, 1, 4, 0, 4])        # æ–°ç”¨æˆ·
    
    cos_heavy = cosine_similarity([ç›®æ ‡ç”¨æˆ·], [é‡åº¦å¬ä¼—])[0][0]
    cos_light = cosine_similarity([ç›®æ ‡ç”¨æˆ·], [è½»åº¦å¬ä¼—])[0][0]
    
    print(f"ç›®æ ‡ç”¨æˆ· vs é‡åº¦å¬ä¼—: {cos_heavy:.3f}")
    print(f"ç›®æ ‡ç”¨æˆ· vs è½»åº¦å¬ä¼—: {cos_light:.3f}")
    print(f"ç»“è®º: ä¸¤è€…åå¥½æ¨¡å¼ç›¸ä¼¼ï¼Œå¯ä»¥äº’ç›¸æ¨è!")

def visualization():
    """å¯è§†åŒ–ä½™å¼¦ç›¸ä¼¼åº¦çš„å‡ ä½•æ„ä¹‰"""
    print(f"\nğŸ“Š ç”Ÿæˆä½™å¼¦ç›¸ä¼¼åº¦å¯è§†åŒ–...")
    
    # åˆ›å»º2Då‘é‡ç”¨äºå¯è§†åŒ–
    vectors = {
        'ç”¨æˆ·A': np.array([4, 2]),
        'ç”¨æˆ·B': np.array([8, 4]),  # ä¸Aæ–¹å‘ç›¸åŒï¼Œä½†æ›´é•¿
        'ç”¨æˆ·C': np.array([2, 4]),  # ä¸Aæ–¹å‘ä¸åŒ
        'ç”¨æˆ·D': np.array([-2, -1]) # ä¸Aæ–¹å‘ç›¸å
    }
    
    fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(15, 6))
    
    # å·¦å›¾ï¼šå‘é‡å¯è§†åŒ–
    colors = ['red', 'blue', 'green', 'orange']
    
    for i, (name, vec) in enumerate(vectors.items()):
        ax1.arrow(0, 0, vec[0], vec[1], head_width=0.2, head_length=0.3, 
                 fc=colors[i], ec=colors[i], linewidth=2, label=name)
        ax1.text(vec[0]*1.1, vec[1]*1.1, name, fontsize=10, color=colors[i])
    
    ax1.set_xlim(-3, 9)
    ax1.set_ylim(-2, 5)
    ax1.set_xlabel('ç‰¹å¾1')
    ax1.set_ylabel('ç‰¹å¾2')
    ax1.set_title('å‘é‡å¯è§†åŒ–')
    ax1.grid(True, alpha=0.3)
    ax1.legend()
    
    # å³å›¾ï¼šç›¸ä¼¼åº¦å¯¹æ¯”
    base_vector = vectors['ç”¨æˆ·A']
    similarities = []
    names = []
    
    for name, vec in vectors.items():
        if name != 'ç”¨æˆ·A':
            cos_sim = cosine_similarity([base_vector], [vec])[0][0]
            similarities.append(cos_sim)
            names.append(name)
    
    bars = ax2.bar(names, similarities, color=['blue', 'green', 'orange'], alpha=0.7)
    ax2.set_ylabel('ä½™å¼¦ç›¸ä¼¼åº¦')
    ax2.set_title('ç”¨æˆ·Aä¸å…¶ä»–ç”¨æˆ·çš„ä½™å¼¦ç›¸ä¼¼åº¦')
    ax2.set_ylim(-1.1, 1.1)
    ax2.axhline(y=0, color='black', linestyle='--', alpha=0.5)
    ax2.grid(axis='y', alpha=0.3)
    
    # æ·»åŠ æ•°å€¼æ ‡ç­¾
    for bar, sim in zip(bars, similarities):
        height = bar.get_height()
        ax2.text(bar.get_x() + bar.get_width()/2., height + 0.05,
                f'{sim:.2f}', ha='center', va='bottom')
    
    plt.tight_layout()
    plt.show()
    
    print(f"å›¾è¡¨è¯´æ˜:")
    print(f"- å·¦å›¾ï¼šå‘é‡çš„æ–¹å‘å’Œé•¿åº¦")
    print(f"- å³å›¾ï¼šä½™å¼¦ç›¸ä¼¼åº¦åªå…³æ³¨æ–¹å‘ï¼Œä¸å…³æ³¨é•¿åº¦")
    print(f"- ç”¨æˆ·Bä¸Aæ–¹å‘ç›¸åŒï¼Œç›¸ä¼¼åº¦æœ€é«˜")
    print(f"- ç”¨æˆ·Dä¸Aæ–¹å‘ç›¸åï¼Œç›¸ä¼¼åº¦ä¸ºè´Ÿ")

def summary():
    """æ€»ç»“"""
    print(f"\n" + "="*50)
    print(f"ğŸ“ ä½™å¼¦ç›¸ä¼¼åº¦æ€»ç»“")
    print(f"="*50)
    
    print(f"\nğŸ¯ ä¸ºä»€ä¹ˆä½™å¼¦ç›¸ä¼¼åº¦æ›´å‡†ç¡®ï¼Ÿ")
    print(f"1. æ¶ˆé™¤è§„æ¨¡å½±å“ï¼šä¸å—å‘é‡é•¿åº¦å½±å“ï¼Œåªçœ‹æ–¹å‘")
    print(f"2. æ ‡å‡†åŒ–æ¯”è¾ƒï¼šæ‰€æœ‰ç”¨æˆ·åœ¨åŒä¸€æ ‡å‡†ä¸‹æ¯”è¾ƒ")
    print(f"3. æ›´å…¬å¹³ï¼šå¤§å®¢æˆ·å’Œå°å®¢æˆ·äº«å—åŒç­‰æƒé‡")
    print(f"4. æ›´ç¨³å®šï¼šä¸ä¼šå› ä¸ºè´­ä¹°é¢‘æ¬¡å·®å¼‚å½±å“æ¨èè´¨é‡")
    
    print(f"\nğŸ“Š ç‚¹ç§¯ vs ä½™å¼¦ç›¸ä¼¼åº¦:")
    print(f"ç‚¹ç§¯:")
    print(f"  - ä¼˜ç‚¹ï¼šè®¡ç®—ç®€å•ï¼Œåæ˜ ç»å¯¹å·®å¼‚")
    print(f"  - ç¼ºç‚¹ï¼šå—å‘é‡é•¿åº¦å½±å“ï¼Œå¯¹å¤§å®¢æˆ·æœ‰åè§")
    print(f"  - é€‚ç”¨ï¼šå‘é‡é•¿åº¦ç›¸è¿‘çš„åœºæ™¯")
    
    print(f"\nä½™å¼¦ç›¸ä¼¼åº¦:")
    print(f"  - ä¼˜ç‚¹ï¼šåªå…³æ³¨æ¨¡å¼ï¼Œæ¶ˆé™¤è§„æ¨¡å½±å“")
    print(f"  - ç¼ºç‚¹ï¼šè®¡ç®—ç¨å¤æ‚ï¼Œå¿½ç•¥ç»å¯¹å·®å¼‚")
    print(f"  - é€‚ç”¨ï¼šç”¨æˆ·è§„æ¨¡å·®å¼‚å¾ˆå¤§çš„åœºæ™¯ â­ æ¨è")
    
    print(f"\nğŸš€ å®é™…åº”ç”¨å»ºè®®:")
    print(f"- æ¨èç³»ç»Ÿï¼šä¼˜å…ˆä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦")
    print(f"- ç”¨æˆ·åˆ†ç¾¤ï¼šä½™å¼¦ç›¸ä¼¼åº¦æ›´å…¬å¹³")
    print(f"- å†…å®¹åŒ¹é…ï¼šä½™å¼¦ç›¸ä¼¼åº¦æ›´å‡†ç¡®")
    print(f"- å¼‚å¸¸æ£€æµ‹ï¼šç»“åˆä½¿ç”¨ä¸¤ç§æŒ‡æ ‡")

if __name__ == "__main__":
    explain_cosine_similarity()
    demonstrate_cosine_advantage()
    real_world_scenarios()
    visualization()
    summary() 