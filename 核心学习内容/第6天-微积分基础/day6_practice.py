#!/usr/bin/env python3
"""
ç¬¬6å¤©ç¼–ç¨‹ç»ƒä¹ ï¼šå¾®ç§¯åˆ†åŸºç¡€
æ—¶é—´ï¼š15-20åˆ†é’Ÿ
ç›®æ ‡ï¼šç†è§£å¯¼æ•°ã€åå¯¼æ•°ã€æ¢¯åº¦çš„æ¦‚å¿µ
"""

import numpy as np
import matplotlib.pyplot as plt

# è®¾ç½®ä¸­æ–‡å­—ä½“
plt.rcParams['font.sans-serif'] = ['Arial Unicode MS', 'SimHei']
plt.rcParams['axes.unicode_minus'] = False

print("ğŸ§® ç¬¬6å¤©ç¼–ç¨‹ç»ƒä¹ ï¼šå¾®ç§¯åˆ†åŸºç¡€")
print("=" * 35)
print("ç†è§£å˜åŒ–çš„æ•°å­¦è¯­è¨€ï¼")
print()

# ==========================================
# ç»ƒä¹ 1ï¼šå¯¼æ•°è®¡ç®—å’Œå¯è§†åŒ–
# ==========================================
print("ğŸ“ˆ ç»ƒä¹ 1ï¼šå¯¼æ•°è®¡ç®—å’Œå¯è§†åŒ–")
print("-" * 25)

# å®šä¹‰å‡½æ•° f(x) = xÂ³ - 3x + 1
def f(x):
    return x**3 - 3*x + 1

# TODO 1: è®¡ç®—å¯¼æ•° f'(x) = 3xÂ² - 3
def f_derivative(x):
    # ä½ çš„ä»£ç ï¼šè®¡ç®— f(x) = xÂ³ - 3x + 1 çš„å¯¼æ•°
    pass

# æµ‹è¯•æ•°æ®
x_test = 2
print(f"æµ‹è¯•ç‚¹ x = {x_test}")
print(f"f({x_test}) = {f(x_test)}")
# print(f"f'({x_test}) = {f_derivative(x_test)}")  # å–æ¶ˆæ³¨é‡Šæµ‹è¯•

# TODO 2: å¯è§†åŒ–å‡½æ•°å’Œå¯¼æ•°
# è¦æ±‚ï¼š
# - åˆ›å»ºä¸¤ä¸ªå­å›¾
# - å·¦å›¾æ˜¾ç¤ºåŸå‡½æ•° f(x)
# - å³å›¾æ˜¾ç¤ºå¯¼æ•°å‡½æ•° f'(x)
# - æ ‡è®°å¯¼æ•°ä¸º0çš„ç‚¹ï¼ˆæå€¼ç‚¹ï¼‰

# ä½ çš„ä»£ç ï¼š


print("å®Œæˆå¯¼æ•°ç»ƒä¹ ï¼")
print()

# ==========================================
# ç»ƒä¹ 2ï¼šåå¯¼æ•°è®¡ç®—
# ==========================================
print("ğŸ” ç»ƒä¹ 2ï¼šåå¯¼æ•°è®¡ç®—")
print("-" * 20)

# å®šä¹‰äºŒå…ƒå‡½æ•° f(x,y) = xÂ² + yÂ² + 2xy
def f_2d(x, y):
    return x**2 + y**2 + 2*x*y

# TODO 3: è®¡ç®—åå¯¼æ•°
def partial_x(x, y):
    # å¯¹xçš„åå¯¼æ•°ï¼šâˆ‚f/âˆ‚x = 2x + 2y
    # ä½ çš„ä»£ç ï¼š
    pass

def partial_y(x, y):
    # å¯¹yçš„åå¯¼æ•°ï¼šâˆ‚f/âˆ‚y = 2y + 2x
    # ä½ çš„ä»£ç ï¼š
    pass

# æµ‹è¯•åå¯¼æ•°
x_test, y_test = 1, 2
print(f"æµ‹è¯•ç‚¹ ({x_test}, {y_test})")
print(f"f({x_test}, {y_test}) = {f_2d(x_test, y_test)}")
# print(f"âˆ‚f/âˆ‚x = {partial_x(x_test, y_test)}")  # å–æ¶ˆæ³¨é‡Šæµ‹è¯•
# print(f"âˆ‚f/âˆ‚y = {partial_y(x_test, y_test)}")  # å–æ¶ˆæ³¨é‡Šæµ‹è¯•

print("å®Œæˆåå¯¼æ•°ç»ƒä¹ ï¼")
print()

# ==========================================
# ç»ƒä¹ 3ï¼šæ¢¯åº¦è®¡ç®—å’Œå¯è§†åŒ–
# ==========================================
print("ğŸ¯ ç»ƒä¹ 3ï¼šæ¢¯åº¦è®¡ç®—å’Œå¯è§†åŒ–")
print("-" * 25)

# TODO 4: è®¡ç®—æ¢¯åº¦
def gradient(x, y):
    # æ¢¯åº¦æ˜¯æ‰€æœ‰åå¯¼æ•°ç»„æˆçš„å‘é‡
    # grad_f = [âˆ‚f/âˆ‚x, âˆ‚f/âˆ‚y]
    # ä½ çš„ä»£ç ï¼š
    pass

# TODO 5: æ¢¯åº¦å¯è§†åŒ–
# è¦æ±‚ï¼š
# - åˆ›å»ºå‡½æ•°çš„ç­‰é«˜çº¿å›¾
# - åœ¨å‡ ä¸ªç‚¹ä¸Šç»˜åˆ¶æ¢¯åº¦å‘é‡
# - è§‚å¯Ÿæ¢¯åº¦æŒ‡å‘å‡½æ•°å¢é•¿æœ€å¿«çš„æ–¹å‘

# ä½ çš„ä»£ç ï¼š


print("å®Œæˆæ¢¯åº¦ç»ƒä¹ ï¼")
print()

# ==========================================
# ç»ƒä¹ 4ï¼šç®€å•çš„æ¢¯åº¦ä¸‹é™
# ==========================================
print("âš¡ ç»ƒä¹ 4ï¼šç®€å•çš„æ¢¯åº¦ä¸‹é™")
print("-" * 25)

# ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ‰¾åˆ°å‡½æ•° f(x) = (x-3)Â² + 1 çš„æœ€å°å€¼
def simple_function(x):
    return (x - 3)**2 + 1

def simple_derivative(x):
    return 2 * (x - 3)

# TODO 6: å®ç°æ¢¯åº¦ä¸‹é™
def gradient_descent():
    # åˆå§‹ç‚¹
    x = 0.0
    learning_rate = 0.1
    steps = 20
    
    print("æ¢¯åº¦ä¸‹é™è¿‡ç¨‹ï¼š")
    for i in range(steps):
        # è®¡ç®—å½“å‰ç‚¹çš„å‡½æ•°å€¼å’Œå¯¼æ•°
        fx = simple_function(x)
        grad = simple_derivative(x)
        
        print(f"æ­¥éª¤ {i+1}: x = {x:.3f}, f(x) = {fx:.3f}, f'(x) = {grad:.3f}")
        
        # TODO: æ›´æ–° x
        # x = x - learning_rate * grad
        # ä½ çš„ä»£ç ï¼š
        
        # å¦‚æœæ¢¯åº¦å¾ˆå°ï¼Œè¯´æ˜æ¥è¿‘æœ€å°å€¼
        if abs(grad) < 0.001:
            print(f"æ”¶æ•›ï¼æœ€å°å€¼ç‚¹çº¦ä¸º x = {x:.3f}")
            break
    
    return x

# è¿è¡Œæ¢¯åº¦ä¸‹é™
# final_x = gradient_descent()  # å–æ¶ˆæ³¨é‡Šè¿è¡Œ

print("å®Œæˆæ¢¯åº¦ä¸‹é™ç»ƒä¹ ï¼")
print()

# ==========================================
# ç»ƒä¹ æ€»ç»“
# ==========================================
print("ğŸ‰ ç»ƒä¹ å®Œæˆæ£€æŸ¥")
print("=" * 20)
print("è¯·æ£€æŸ¥ä½ æ˜¯å¦å®Œæˆäº†ï¼š")
print("â–¡ ç»ƒä¹ 1ï¼šå¯¼æ•°è®¡ç®—å’Œå¯è§†åŒ–")
print("â–¡ ç»ƒä¹ 2ï¼šåå¯¼æ•°è®¡ç®—")
print("â–¡ ç»ƒä¹ 3ï¼šæ¢¯åº¦è®¡ç®—å’Œå¯è§†åŒ–")
print("â–¡ ç»ƒä¹ 4ï¼šç®€å•çš„æ¢¯åº¦ä¸‹é™")
print()
print("ğŸ’¡ å¦‚æœé‡åˆ°å›°éš¾ï¼Œå¯ä»¥ï¼š")
print("1. å›é¡¾notebookä¸­çš„ç†è®º")
print("2. æŸ¥çœ‹ä¸‹é¢çš„æç¤º")
print("3. é—®æˆ‘å…·ä½“é—®é¢˜")

# ==========================================
# æç¤ºåŒºåŸŸï¼ˆå¡ä½äº†å†çœ‹ï¼‰
# ==========================================
print("\n" + "="*50)
print("ğŸ’¡ æç¤ºåŒºåŸŸï¼ˆå¡ä½äº†å†çœ‹ï¼‰")
print("="*50)

print("\nğŸ“ˆ ç»ƒä¹ 1æç¤ºï¼ˆå¯¼æ•°ï¼‰:")
print("def f_derivative(x):")
print("    return 3*x**2 - 3")
print()
print("# å¯è§†åŒ–")
print("x = np.linspace(-3, 3, 100)")
print("plt.subplot(1, 2, 1)")
print("plt.plot(x, f(x))")
print("plt.title('åŸå‡½æ•°')")

print("\nğŸ” ç»ƒä¹ 2æç¤ºï¼ˆåå¯¼æ•°ï¼‰:")
print("def partial_x(x, y):")
print("    return 2*x + 2*y")
print()
print("def partial_y(x, y):")
print("    return 2*y + 2*x")

print("\nğŸ¯ ç»ƒä¹ 3æç¤ºï¼ˆæ¢¯åº¦ï¼‰:")
print("def gradient(x, y):")
print("    return [partial_x(x, y), partial_y(x, y)]")
print()
print("# ç­‰é«˜çº¿å›¾")
print("X, Y = np.meshgrid(x_range, y_range)")
print("Z = f_2d(X, Y)")
print("plt.contour(X, Y, Z)")

print("\nâš¡ ç»ƒä¹ 4æç¤ºï¼ˆæ¢¯åº¦ä¸‹é™ï¼‰:")
print("# æ¢¯åº¦ä¸‹é™æ›´æ–°è§„åˆ™")
print("x = x - learning_rate * grad")
print("# learning_rate æ˜¯å­¦ä¹ ç‡ï¼Œæ§åˆ¶æ­¥é•¿")

print("\nğŸ¯ è®°ä½ï¼šå…ˆè‡ªå·±å°è¯•ï¼Œå†çœ‹æç¤ºï¼")
print("ğŸš€ å®Œæˆåä½ å°±ç†è§£äº†å¾®ç§¯åˆ†çš„æ ¸å¿ƒæ¦‚å¿µï¼") 